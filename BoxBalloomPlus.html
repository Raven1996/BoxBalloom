<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Box Balloon +</title>
<script type="text/javascript">

window.onload=function(){
	ClickFunction();
	}

function ClickFunction(){
	var canvas = document.getElementById('canvas');
	var context = canvas.getContext("2d");
	var WIDTH = canvas.width;
	context.fillStyle = "#FFF";
	context.fillRect(0, 0, 640, 640);
	var bnum=-1;
	var givennum=parseInt(document.getElementById("num").value);
	var prcs=640; //精度
	var que=new Array();
	var dot=new Array();
	var dnum=-1;
	var flag;
	
	var adot={
			x:0,
			y:0
		}
	dot.push(adot);
	dnum++;
	
	var x0=0;
	var y0=0;
	var r0=prcs+1;
	while (givennum>0&&r0>0){ 
		flag=true;
		bnum++;
		while (flag){
			if (x0==0 && y0==0){
				r0--;
				x0=-prcs+r0;
				y0=-prcs+r0;
				}
			flag=false;
			while (Collide(x0,y0,r0)){
				if (x0<0 && y0<0){
					x0++;
					if (x0==0){
						x0=-prcs+r0;
						y0++;
						}
					if (y0==0){
						x0=prcs-r0;
						y0=-prcs+r0;
						}
					}
				else if (x0>0 && y0<0){
					x0--;
					if (x0==0){
						x0=prcs-r0;
						y0++;
						}
					if (y0==0){
						x0=-prcs+r0;
						y0=prcs-r0;
						}
					} 
				else if (x0<0 && y0>0){
					x0++;
					if (x0==0){
						x0=-prcs+r0;
						y0--;
						}
					if (y0==0){
						x0=prcs-r0;
						y0=prcs-r0;
						}
					}
				else if (x0>0 && y0>0){
					x0--;
					if (x0==0){
						x0=prcs-r0;
						y0--;
						}
					if (y0==0){
						x0=0;
						}
					}
				else if (x0==0 && y0==0){
					flag=true;
					break;
					}
				if (r0==prcs){
					r0--;
					x0=-prcs+r0;
					y0=-prcs+r0;
					}
				}
			
			}
		var aballoom={
			x:x0,
			y:y0,
			r:r0
		}
		que.push(aballoom);
		
		DrawCircle(que[bnum].x, que[bnum].y, que[bnum].r);
		givennum-=1;
		}
	
	function Collide(x, y, r){
		var distance
		for (var i=0; i<bnum; i++){
			distance = Math.pow((que[i].x-x)*(que[i].x-x)+(que[i].y-y)*(que[i].y-y), 0.5);
			if (distance<r+que[i].r){
				return true;
			}
		}
		for (var i=0; i<=dnum; i++){
			distance = Math.pow((dot[i].x-x)*(dot[i].x-x)+(dot[i].y-y)*(dot[i].y-y), 0.5);
			if (distance<r){
				return true;
			}
		}
		return false;
	}

	function DrawCircle(x, y, r){
		context.fillStyle = "rgba(0, 0, 0, 0.618)";
		context.beginPath();
		context.arc(x*WIDTH/2/prcs+WIDTH/2, y*WIDTH/2/prcs+WIDTH/2, r*WIDTH/2/prcs, 0, Math.PI*2, false);
		context.closePath();
		context.fill();
	}
}
</script>

</head>
<body style="margin:0px;padding:0px; overflow:hidden;">
<div id="container" style="height:100%;width:100%;">
	<canvas id="canvas" width="640" height="640" style="border:1px solid #aaa;position:absolute;left:40%;top:50%;transform:translate(-50%,-50%);">
	Please try another browser.
	</canvas>
	<div id="left" style="height:100%;width:20%;position:absolute;right:0%;background-color:#DDD;font-family:Arial,'Microsoft YaHei';">
		<div style="position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);text-align:center;">
			<form style="word-break:keep-all;white-space:nowrap;overflow:hidden;">
			数量：
			<input id="num" type="text" style="line-height:1.5em;width:4em;" value="22"/>
			</form>
			<br />
			<a type="button"  href="javascript:ClickFunction()" style="margin:0px auto;line-height:1.5em;text-decoration:none;background-color:#aaa;color:#fff;padding:0.5em 1em;border-radius:0.5em;">生成</a>
		</div>
	</div>
</div>
</body>
</html>